<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LKL Statymų Prognozė</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f2f2f2; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin: 20px 0; background: #fff;}
th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
th { background: #0077cc; color: #fff; }
.bar { height: 20px; background-color: #0077cc; margin: 2px 0; }
.over { background-color: #28a745; }
.under { background-color: #dc3545; }
</style>
</head>
<body>

<h1>LKL Prognozė – Win/Lose, Over/Under</h1>

<div id="topStats"></div>
<canvas id="probChart" width="400" height="200"></canvas>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Komanda 1</th>
      <th>Komanda 2</th>
      <th>Win %</th>
      <th>Lose %</th>
      <th>Prognozuotas skirtumas</th>
      <th>Over %</th>
      <th>Under %</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 9 LKL komandos
const teams = [
  "Žalgiris Kaunas",
  "Lietuvos Rytas",
  "Neptūnas Klaipėda",
  "Lietkabelis Panevėžys",
  "Šiauliai",
  "Juventus Utenos",
  "Gargždai",
  "Nevežis Kėdainiai",
  "Jonava"
];

// Paskutinių 15 rungtynių rezultatai (pavyzdiniai)
const last15Matches = {
  "Žalgiris Kaunas":[112,101,95,108,102,99,110,103,107,104,98,97,105,109,111],
  "Lietuvos Rytas":[81,85,88,92,89,86,90,87,84,91,83,85,88,86,89],
  "Lietkabelis Panevėžys":[89,77,84,91,82,88,85,86,79,83,87,81,90,84,86],
  "Neptūnas Klaipėda":[77,85,88,90,84,86,79,87,85,88,90,83,81,86,88],
  "Šiauliai":[98,95,100,102,99,97,101,96,98,94,100,97,95,99,101],
  "Juventus Utenos":[83,87,85,88,82,86,81,83,85,87,84,88,86,83,85],
  "Gargždai":[82,79,85,80,83,81,79,82,80,84,81,83,80,82,85],
  "Nevežis Kėdainiai":[77,80,79,82,78,80,77,79,81,78,80,82,79,77,81],
  "Jonava":[75,78,77,80,76,78,75,77,79,76,78,80,77,75,79]
};

// Paskutinės 4 H2H rungtynės (faktiški pavyzdžiai)
const headToHead = {
  "Zalgiris Kaunas_Lietuvos Rytas":[
    {score1:90,score2:81},{score1:79,score2:75},{score1:76,score2:69},{score1:104,score2:98}
  ],
  "Lietuvos Rytas_Siauliai":[
    {score1:105,score2:100},{score1:94,score2:79},{score1:110,score2:84},{score1:127,score2:81}
  ],
  "Lietuvos Rytas_Lietkabelis":[
    {score1:94,score2:70},{score1:76,score2:87},{score1:87,score2:86},{score1:92,score2:88}
  ]
};

// Funkcija: vidurkis
function avg(arr){ return arr.reduce((a,b)=>a+b,0)/arr.length; }

// Funkcija: prognozė pagal last15 + H2H
function predict(team1, team2){
  const last15Avg1 = avg(last15Matches[team1]);
  const last15Avg2 = avg(last15Matches[team2]);
  const last15WinProb = last15Avg1/(last15Avg1+last15Avg2);

  const h2hKey = headToHead[team1+"_"+team2] || headToHead[team2+"_"+team1];
  let h2hWinProb = 0.5;
  let h2hAvgDiff = 0;
  if(h2hKey){
    const scores1 = h2hKey.map(x=>x.score1);
    const scores2 = h2hKey.map(x=>x.score2);
    h2hWinProb = avg(scores1)/(avg(scores1)+avg(scores2));
    h2hAvgDiff = avg(scores1)-avg(scores2);
    if(h2hKey===headToHead[team2+"_"+team1]) h2hAvgDiff*=-1;
  }

  const finalWinProb = 0.5*last15WinProb + 0.5*h2hWinProb;
  const finalLoseProb = 1-finalWinProb;
  const predictedDiff = (last15Avg1-last15Avg2)*0.5 + h2hAvgDiff*0.5;
  const over = Math.min(0.95, Math.max(0.05, (last15Avg1+last15Avg2)/200));
  const under = 1-over;

  return {win:finalWinProb,lose:finalLoseProb,diff:predictedDiff.toFixed(1),over:(over*100).toFixed(0),under:(under*100).toFixed(0)};
}

// Generuoti lentelę
const tbody = document.querySelector("#resultsTable tbody");
for(let i=0;i<teams.length;i++){
  for(let j=i+1;j<teams.length;j++){
    const team1=teams[i], team2=teams[j];
    const p=predict(team1,team2);
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${team1}</td><td>${team2}</td><td>${(p.win*100).toFixed(1)}%</td><td>${(p.lose*100).toFixed(1)}%</td><td>${p.diff}</td><td>${p.over}%</td><td>${p.under}%</td>`;
    tbody.appendChild(tr);
  }
}

// Top 3 rekomendacijos (pvz. pagal win%)
const allPairs=[];
for(let i=0;i<teams.length;i++){
  for(let j=i+1;j<teams.length;j++){
    const team1=teams[i], team2=teams[j];
    const p=predict(team1,team2);
    allPairs.push({pair:`${team1} vs ${team2}`,win:p.win});
  }
}
allPairs.sort((a,b)=>b.win-a.win);
const topDiv=document.getElementById("topStats");
topDiv.innerHTML="<h2>Top 3 statymų rekomendacijos (pagal Win %)</h2><ol>"+allPairs.slice(0,3).map(x=>`<li>${x.pair} – ${(x.win*100).toFixed(1)}%</li>`).join('')+"</ol>";

// Paprastas grafikas su Chart.js
const ctx=document.getElementById("probChart").getContext("2d");
new Chart(ctx,{type:'bar',data:{
  labels:allPairs.map(x=>x.pair),
  datasets:[{label:'Win %',data:allPairs.map(x=>(x.win*100).toFixed(1)),backgroundColor:'#0077cc'}]
},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{ticks:{maxRotation:90,minRotation:45}},y:{beginAtZero:true}}}});
</script>

</body>
</html>
