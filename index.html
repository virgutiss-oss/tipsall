<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interaktyvus Sporto Dashboard</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; color:#333; }
header { background:#007bff; color:#fff; padding:20px; text-align:center; }
main { padding:20px; max-width:1200px; margin:0 auto; }
h1,h2 { margin-bottom:10px; }
.filters { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
select, input { padding:8px; font-size:16px; }
.cards-container { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:15px; }
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.15); cursor:pointer; transition: transform 0.2s; }
.card:hover { transform: translateY(-5px); }
.card .diff { font-weight:bold; padding:5px 8px; border-radius:5px; color:#fff; display:inline-block; }
.card .diff.low { background:#28a745; }
.card .diff.medium { background:#ffc107; }
.card .diff.high { background:#dc3545; }
.card-details { display:none; margin-top:10px; font-size:14px; background:#f9f9f9; padding:8px; border-radius:5px; }
.chart-container { margin-top:40px; text-align:center; }
</style>
</head>
<body>
<header>
<h1>Interaktyvus Sporto Dashboard</h1>
<p>Futbolas, krepšinis, tenisas – demo duomenys iš TheSportsDB</p>
</header>
<main>
<div class="filters">
<select id="sport-select"><option value="">-- Visi sportai --</option></select>
<select id="league-select"><option value="">-- Visi lygos --</option></select>
<input type="date" id="date-filter" />
</div>

<div class="cards-container" id="cards-container"></div>

<div class="chart-container">
<h2>TOP 10 pagal rezultatų skirtumą</h2>
<canvas id="resultChart" width="1000" height="400"></canvas>
</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const demoSports = [
    {sport:'Soccer', display:'Futbolas'},
    {sport:'Basketball', display:'Krepšinis'},
    {sport:'Tennis', display:'Tenisas'}
];

let leaguesBySport = {};
let allMatches = [];

async function initSports() {
    const sportSelect = document.getElementById('sport-select');
    for(const s of demoSports){
        const leagues = await fetchLeagues(s.sport);
        leaguesBySport[s.sport] = leagues;
        const option = document.createElement('option');
        option.value = s.sport;
        option.textContent = s.display;
        sportSelect.appendChild(option);
    }
}

async function fetchLeagues(sport) {
    const url = `https://www.thesportsdb.com/api/v1/json/123/search_all_leagues.php?s=${sport}`;
    const resp = await fetch(url);
    const data = await resp.json();
    return data.countrys || [];
}

async function fetchEvents(leagueID) {
    const url = `https://www.thesportsdb.com/api/v1/json/123/eventsnextleague.php?id=${leagueID}`;
    const resp = await fetch(url);
    const data = await resp.json();
    return data.events || [];
}

function updateLeagueSelect(sport) {
    const leagueSelect = document.getElementById('league-select');
    leagueSelect.innerHTML = '<option value="">-- Visi lygos --</option>';
    if(sport && leaguesBySport[sport]){
        leaguesBySport[sport].forEach(l=>{
            const opt = document.createElement('option');
            opt.value = l.idLeague;
            opt.textContent = l.strLeague;
            leagueSelect.appendChild(opt);
        });
    }
}

async function loadAllMatches() {
    allMatches = [];
    for(const s of demoSports){
        const leagues = await fetchLeagues(s.sport);
        leaguesBySport[s.sport] = leagues;
        for(const l of leagues){
            const events = await fetchEvents(l.idLeague);
            events.forEach(ev=>{
                const homeScore = parseInt(ev.intHomeScore) || 0;
                const awayScore = parseInt(ev.intAwayScore) || 0;
                const diff = Math.abs(homeScore-awayScore);
                allMatches.push({
                    date: ev.dateEvent || '',
                    sport: demoSports.find(d=>d.sport===s.sport).display,
                    league: ev.strLeague || l.strLeague,
                    teams: ev.strHomeTeam+' vs '+ev.strAwayTeam,
                    score: homeScore+'-'+awayScore,
                    diff: diff,
                    details: `Rungtynių komentaras demo: ${ev.strEvent || ''}`
                });
            });
        }
    }
    displayFiltered();
}

function displayFiltered() {
    const sport = document.getElementById('sport-select').value;
    const leagueID = document.getElementById('league-select').value;
    const dateFilter = document.getElementById('date-filter').value;

    let filtered = allMatches.slice();
    if(sport) filtered = filtered.filter(m=>m.sport===demoSports.find(d=>d.sport===sport).display);
    if(leagueID) filtered = filtered.filter(m=>m.league===leaguesBySport[sport].find(l=>l.idLeague===leagueID).strLeague);
    if(dateFilter) filtered = filtered.filter(m=>m.date===dateFilter);

    // Rūšiuojame pagal diff didėjimo tvarka
    filtered.sort((a,b)=>b.diff-a.diff);

    const cardsContainer = document.getElementById('cards-container');
    cardsContainer.innerHTML = '';
    filtered.forEach(m=>{
        let diffClass = m.diff <= 2 ? 'low' : m.diff <=5 ? 'medium' : 'high';
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>${m.teams}</h3>
        <p><strong>Data:</strong> ${m.date}</p>
        <p><strong>Sportas:</strong> ${m.sport}</p>
        <p><strong>Lyga:</strong> ${m.league}</p>
        <p><strong>Rezultatas:</strong> ${m.score}</p>
        <p><strong>Skirtumas:</strong> <span class="diff ${diffClass}">${m.diff}</span></p>
        <div class="card-details">${m.details}</div>`;
        // Toggle details on click
        card.addEventListener('click', ()=> {
            const details = card.querySelector('.card-details');
            details.style.display = details.style.display==='none'?'block':'none';
        });
        cardsContainer.appendChild(card);
    });

    // Grafikas top10 pagal diff
    const top10 = filtered.slice(0,10);
    const ctx = document.getElementById('resultChart').getContext('2d');
    if(window.resultChart) window.resultChart.destroy();
    window.resultChart = new Chart(ctx,{
        type:'bar',
        data:{
            labels: top10.map(d=>d.date+'-'+d.sport),
            datasets:[{
                label:'Rezultatų skirtumas',
                data: top10.map(d=>d.diff),
                backgroundColor:'rgba(0,123,255,0.5)',
                borderColor:'#007bff',
                borderWidth:1
            }]
        },
        options:{responsive:true, plugins:{legend:{display:true}, title:{display:true,text:'TOP 10 Rezultatų Skirtumų'}}, scales:{y:{beginAtZero:true}}}
    });
}

document.getElementById('sport-select').addEventListener('change', e=>{
    const sport = e.target.value;
    updateLeagueSelect(sport);
    displayFiltered();
});
document.getElementById('league-select').addEventListener('change', displayFiltered);
document.getElementById('date-filter').addEventListener('change', displayFiltered);

initSports();
loadAllMatches();
</script>
</body>
</html>
