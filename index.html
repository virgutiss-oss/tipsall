<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Krepšinio Prognozė LKL + ACB + BSL + LNB</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
h1 { text-align: center; color: #2a4d69; }
select, button { padding: 8px; margin: 5px 0; width: 100%; }
#result { margin-top: 20px; background: #fff; padding: 15px; border: 1px solid #ccc; }
canvas { margin-top: 30px; background: #fff; border:1px solid #ccc; }
</style>
</head>
<body>

<h1>Krepšinio Prognozė su Grafiku (LKL, ACB, BSL, LNB)</h1>

<label>Lyga:</label>
<select id="league" onchange="updateTeams()">
  <option value="LKL">LKL</option>
  <option value="ACB">ACB</option>
  <option value="BSL">BSL</option>
  <option value="LNB">LNB</option>
</select>

<label>Komanda 1:</label>
<select id="team1"></select>

<label>Komanda 2:</label>
<select id="team2"></select>

<button onclick="calculate()">Skaičiuoti prognozę</button>

<div id="result"></div>
<canvas id="chart" width="600" height="400"></canvas>

<script>
// ————— JSON su paskutinėmis rungtynėmis ir H2H —————
const data = {
  "LKL": {
    "lastResults": {
      "Žalgiris Kaunas":[{"date":"2026-01-04","opponent":"Neptūnas Klaipėda","teamScore":112,"oppScore":77},{"date":"2025-12-27","opponent":"Rytas","teamScore":90,"oppScore":81}],
      "Rytas":[{"date":"2025-12-27","opponent":"Žalgiris Kaunas","teamScore":81,"oppScore":90},{"date":"2025-11-15","opponent":"Neptūnas Klaipėda","teamScore":104,"oppScore":72}],
      "Neptūnas Klaipėda":[{"date":"2026-01-04","opponent":"Žalgiris Kaunas","teamScore":77,"oppScore":112},{"date":"2025-12-28","opponent":"Šiauliai","teamScore":101,"oppScore":103}],
      "Lietkabelis Panevėžys":[{"date":"2026-01-04","opponent":"Juventus Utenos","teamScore":89,"oppScore":83}],
      "Juventus Utenos":[{"date":"2026-01-04","opponent":"Lietkabelis Panevėžys","teamScore":83,"oppScore":89}],
      "Šiauliai":[{"date":"2026-01-03","opponent":"Nevėžis Kėdainiai","teamScore":98,"oppScore":95}],
      "Nevėžis Kėdainiai":[{"date":"2026-01-03","opponent":"Šiauliai","teamScore":95,"oppScore":98}],
      "Gargždai":[{"date":"2026-01-03","opponent":"Jonava Hipocredit","teamScore":82,"oppScore":75}],
      "Jonava Hipocredit":[{"date":"2026-01-03","opponent":"Gargždai","teamScore":75,"oppScore":82}]
    },
    "H2H":{
      "Žalgiris Kaunas_Rytas":[{"date":"2025-12-27","team1Score":90,"team2Score":81}],
      "Neptūnas Klaipėda_Šiauliai":[{"date":"2025-12-28","team1Score":101,"team2Score":103}]
    }
  },
  "ACB": {
    "lastResults":{
      "Real Madrid":[{"date":"2026-01-04","opponent":"Barcelona","teamScore":100,"oppScore":105}],
      "Barcelona":[{"date":"2026-01-04","opponent":"Real Madrid","teamScore":105,"oppScore":100}],
      "Valencia Basket":[{"date":"2026-01-02","opponent":"Bilbao Basket","teamScore":116,"oppScore":72}],
      "Surne Bilbao Basket":[{"date":"2026-01-02","opponent":"Valencia Basket","teamScore":72,"oppScore":116}]
    },
    "H2H":{
      "Real Madrid_Barcelona":[{"date":"2026-01-04","team1Score":100,"team2Score":105}],
      "Valencia Basket_Surne Bilbao Basket":[{"date":"2026-01-02","team1Score":116,"team2Score":72}]
    }
  },
  "BSL": {
    "lastResults":{
      "Fenerbahçe Beko":[{"date":"2025-10-12","opponent":"Petkim Spor","teamScore":105,"oppScore":83}],
      "Beşiktaş GAİN":[{"date":"2025-10-12","opponent":"Türk Telekom","teamScore":77,"oppScore":72}],
      "Anadolu Efes":[{"date":"2025-10-11","opponent":"Tofaş","teamScore":98,"oppScore":85}],
      "Türk Telekom":[{"date":"2025-10-12","opponent":"Beşiktaş GAİN","teamScore":72,"oppScore":77}]
    },
    "H2H":{
      "Fenerbahçe Beko_Beşiktaş GAİN":[{"date":"2025-10-06","team1Score":87,"team2Score":73}]
    }
  },
  "LNB": {
    "lastResults":{
      "AS Monaco":[{"date":"2025-10-26","opponent":"Chalon Saone","teamScore":92,"oppScore":85}],
      "Paris Basketball":[{"date":"2025-10-26","opponent":"Chalon Saone","teamScore":107,"oppScore":67}],
      "ASVEL Lyon-Villeurbanne":[{"date":"2025-10-25","opponent":"Limoges CSP","teamScore":95,"oppScore":87}]
    },
    "H2H":{}
  }
};

// ————— Dinamiškai užpildyti komandų select —————
function updateTeams() {
  const league = document.getElementById("league").value;
  const teams = Object.keys(data[league].lastResults);
  const team1 = document.getElementById("team1");
  const team2 = document.getElementById("team2");
  team1.innerHTML = "";
  team2.innerHTML = "";
  teams.forEach(t => {
    team1.innerHTML += `<option value="${t}">${t}</option>`;
    team2.innerHTML += `<option value="${t}">${t}</option>`;
  });
}
updateTeams();

// ————— Skaičiavimo logika su bendru Over/Under —————
function calculate() {
  const league = document.getElementById("league").value;
  const t1 = document.getElementById("team1").value;
  const t2 = document.getElementById("team2").value;
  const lastResults = data[league].lastResults;
  const h2h = data[league].H2H;

  const r1 = lastResults[t1] || [];
  const r2 = lastResults[t2] || [];

  const winPct1 = r1.length ? ((r1.filter(x => x.teamScore > x.oppScore).length / r1.length) * 100).toFixed(1) : 0;
  const winPct2 = r2.length ? ((r2.filter(x => x.teamScore > x.oppScore).length / r2.length) * 100).toFixed(1) : 0;

  const avg1 = r1.length ? (r1.reduce((a,b)=>a+b.teamScore,0)/r1.length).toFixed(1) : 0;
  const avg2 = r2.length ? (r2.reduce((a,b)=>a+b.teamScore,0)/r2.length).toFixed(1) : 0;

  const key = `${t1}_${t2}`;
  const keyAlt = `${t2}_${t1}`;
  const hh = h2h[key] || h2h[keyAlt] || [];
  const hAvg1 = hh.length ? (hh.reduce((a,b)=>a + b.team1Score,0)/hh.length).toFixed(1) : 0;
  const hAvg2 = hh.length ? (hh.reduce((a,b)=>a + b.team2Score,0)/hh.length).toFixed(1) : 0;

  let predWinner = "N/A";
  if(hAvg1 && hAvg2) predWinner = parseFloat(hAvg1) > parseFloat(hAvg2) ? t1 : t2;
  else predWinner = parseFloat(winPct1) > parseFloat(winPct2) ? t1 : t2;

  let totalScorePrediction = 0;
  if(hAvg1 && hAvg2) {
    totalScorePrediction = (parseFloat(hAvg1) + parseFloat(hAvg2)).toFixed(1);
  } else {
    totalScorePrediction = ((parseFloat(avg1) + parseFloat(avg2))/2*2).toFixed(1);
  }

  document.getElementById("result").innerHTML = `
    <strong>Prognozuojamas laimėtojas:</strong> ${predWinner}<br>
    <strong>${t1} Win %:</strong> ${winPct1}%<br>
    <strong>${t2} Win %:</strong> ${winPct2}%<br>
    <strong>${t1} avg taškai:</strong> ${avg1}<br>
    <strong>${t2} avg taškai:</strong> ${avg2}<br>
    <strong>H2H avg:</strong> ${hAvg1} : ${hAvg2}<br>
    <strong>Bendras Over/Under prognozė:</strong> ${totalScorePrediction}
  `;

  drawChart([winPct1, winPct2],[avg1,avg2],totalScorePrediction,t1,t2);
}

// ————— Grafiko funkcija —————
let chartInstance = null;
function drawChart(winPct, avgPoints, ou, t1, t2){
  const ctx = document.getElementById('chart').getContext('2d');
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx,{
    type:'bar',
    data:{
      labels:[`${t1} Win %`,`${t2} Win %`,`Bendras Over/Under`],
      datasets:[{
        label:'Prognozė',
        data:[winPct[0],winPct[1],ou],
        backgroundColor:['#2a4d69','#4b86b4','#adcbe3']
      }]
    },
    options:{
      responsive:true,
      scales:{y:{beginAtZero:true}}
    }
  });
}
</script>

</body>
</html>
